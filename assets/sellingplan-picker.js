!function(){class e extends HTMLElement{constructor(){super()}connectedCallback(){let e=this.querySelectorAll('[name="purchase-option"]'),t=this.querySelectorAll("theme-select.selling-plan-select");for(let t of e)t.addEventListener("input",e=>{if("subscription"==t.value){let e=this.querySelector(`label[for="${t.id}"]`).querySelector('[name="current-selling-plan"]');e&&this.setSellingPlan(e.value)}"onetime"==t.value&&this.removeSellingPlan()});for(let e of t)e.addEventListener("change",t=>{let l=e.value;l&&this.setSellingPlan(l)})}updateDOM(e,t){let l=this;l.dataset.sectionId,l.classList.remove("loading"),fetch(e,{credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest"},method:"GET"}).then(e=>e.text()).then(e=>{let s=document.createElement("template");s.innerHTML=e.trim(),console.log("handle response TODO",s.content),window.dispatchEvent(new CustomEvent("sellingplan:changed",{bubbles:!0,cancelable:!1,detail:t})),l.classList.remove("loading")}).catch(function(e){l.classList.remove("loading"),console.error(e)})}updateURL(e,t){let l=new URL(document.location);e?l.searchParams.set("variant",e):l.searchParams.delete("variant"),t?l.searchParams.set("selling_plan",t):l.searchParams.delete("selling_plan"),history.replaceState(null,"",l.href)}setSellingPlan(e){let t=this.closest("form.shopify-product-form").querySelector('input[name="id"]').value;this.updateURL(t,e);let l=this.dataset.sectionId,s=this.dataset.productUrl,n=`${s}?variant=${t}&selling_plan=${e}&section_id=${l}`;this.updateDOM(n,e)}removeSellingPlan(){let e=this.closest("form.shopify-product-form").querySelector('input[name="id"]').value;this.updateURL(e,null);let t=this.dataset.sectionId;t||(t=this.closest("form")?.querySelector('input[name="section-id"]')?.value);let l=this.dataset.productUrl,s=`${l}?variant=${e}&section_id=${t}`;this.updateDOM(s,null)}}customElements.define("selling-plan-picker",e)}();
//# sourceMappingURL=sellingplan-picker.js.map
